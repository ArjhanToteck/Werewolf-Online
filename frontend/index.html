<head>
	<style>
		button {
			height: 25;
			width: 105;
		}

		input {
			height: 25;
		}
	</style>
	<title>Werewolf | ArjhanToteck</title>
	<link rel="icon" href="/favicon.png">
	<link href="https://arjhantoteck.vercel.app/style.css" rel="stylesheet" type="text/css" media="all">
</head>

<body>
	<div id="menu">
		<h1 class="glitch" id="heading" data-text="Werewolf">Werewolf</h1>
		<button onclick="startGame()">Host Game</button>
		<button onclick="joinGame()">Join Game</button>
	</div>
	<div id="game" style="display:none;">
		<div id="chat"> </div>
		<br>
		<div id="chatInput">
			<input size="35" autocomplete="off" placeholder="Message" autofocus id="messageBox">
			<button onclick="sendMessage()">Send</button>
		</div>
	</div>
</body>

<script>
const server = "werewolf.arjhantoteck.repl.co";
let password;
let gameCode;
let connection;

function startGame() {
	// creates game and gets code
	fetch(`https://${server}/startGame/`, {method: "POST"})
		.then(response => {
			if (response.ok) return response.text()
			throw new Error('Network response was not ok.')
		})
		.then(function(code){

			// sets code
			document.cookie = `code=${code}; expires=Thu, 25 Dec 2999 12:00:00 UTC;`
			gameCode = code;
		
			// joins game
			console.log(code);
			joinGame(code);
		});
}

function joinGame(code = prompt("code"), name = prompt("name"), spectator = false) {
	fetch(`https://${server}/joinGame/${code}/${name}/${spectator}`, {method: "POST"})
		.then(response => {
			if (response.ok) return response.text()
			throw new Error("Network response was not ok.")
		})
		.then(function(data){
			document.cookie = `password=${data}`;
			password = data;

			// establishes connection with websocket server
			connection = new WebSocket(`wss://${server}`);

			// waits until connection opened
			connection.addEventListener("open", function (event) {
				console.log("opened");
				connection.send(JSON.stringify({password: password, code: code, action: "linkConnection"}));
			});
		});
}

function sendMessage(){
	connection.send(JSON.stringify({password: password, code: gameCode, action: "sendMessage", message: chatInput.value}));
}
</script>
